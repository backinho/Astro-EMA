---
import { actions } from "astro:actions";
---

<form
    id="subCategoryForm"
    class="form-class"
    action={actions.inventario.addCategory}
>
    <div
        class="bg-(--bg-secondary) p-(--spacing-lg) rounded-lg border border-(--border-color)"
    >
        <h3
            class="text-lg font-semibold text-(--text-primary) mb-(--spacing-md) pb-(--spacing-sm) border-b border-(--border-color)"
        >
            Información de la categoría
        </h3>
        <div class="grid gap-(--spacing-lg)">
            <input type="hidden" id="categoryId" name="categoryId" />
            <div class="flex flex-col gap-(--spacing-sm)">
                <label
                    for="categoryName"
                    class="text-sm font-medium text-(--text-primary)"
                    >Nombre</label
                >
                <input
                    class="p-(--spacing-sm) px-(--spacing-md) border border-(--border-color) rounded-lg bg-(--bg-secondary) text-(--text-primary) text-sm transition focus:outline-none focus:border-(--border-focus) focus:ring-2 focus:ring-blue-500/10"
                    type="text"
                    id="categoryName"
                    name="categoryName"
                    required
                />
            </div>
        </div>
    </div>
</form>

<script>
    import { actions } from "astro:actions";

    const form = document.getElementById("subCategoryForm") as HTMLFormElement;

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        console.log("Formulario enviado");
        const formData = new FormData(form);
        const name = formData.get("categoryName") as string;
        const categoryId = Number(formData.get("categoryId"));

        if (!categoryId) {
            const { data, error } = await actions.inventario.addCategory({
                name,
            });

            if (error) {
                console.error("Error al agregar la categoría:", error);
                return;
            }

            console.log("Categoría agregada exitosamente:", data);

            window.updateCategoriesList();

            document
                .getElementById("subCategoryModal")
                ?.classList.remove("active");

            form.reset();
            return;
        }

        if (categoryId) {
            const { data, error } = await actions.inventario.editCategory({
                name,
                categoryId,
            });

            if (error) {
                console.error("Error al editar la categoría:", error);
                return;
            }

            console.log("Categoría editada exitosamente:", data);

            window.updateCategoriesList();

            document
                .getElementById("subCategoryModal")
                ?.classList.remove("active");

            form.reset();
            return;
        }
    });
</script>
